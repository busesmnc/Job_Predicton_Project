import pandas as pd
from sklearn.preprocessing import MultiLabelBinarizer, LabelEncoder
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score, classification_report

print("ðŸ“¥ Veriler yÃ¼kleniyor...")
df = pd.read_csv("/Users/busesomunncu/Desktop/Linkedln Job Prediction Project/final_enriched_dataset.csv")

# -------------------------------
# 1. KATEGORÄ° GRUPLAMA
# -------------------------------
print("ðŸ”¢ Kategoriler gruplandÄ±rÄ±lÄ±yor...")

category_group_map = {
    1: 1, 2: 1, 4: 1,                     # Software & Web Dev
    3: 2, 17: 2,                          # Data & AI
    5: 3, 8: 3, 9: 3, 10: 3,              # IT & Support
    6: 4, 12: 4,                          # DevOps & Reliability
    7: 5,                                 # Cybersecurity
    11: 6, 13: 6, 14: 6, 15: 6, 16: 6,    # Embedded & Hardware
    18: 7, 21: 7,                         # Product & Project Mgmt
    19: 8, 20: 8, 22: 8, 23: 8,           # Business & Analysis
    24: 9, 25: 9, 26: 9, 29: 9,           # Sales & Operations
    27: 10, 28: 10, 30: 10                # Other
}
df['grouped_category_id'] = df['category_id'].map(category_group_map)

# -------------------------------
# 2. Ã–ZELLÄ°K MÃœHENDÄ°SLÄ°ÄžÄ°
# -------------------------------
print("Ã–zellikler iÅŸleniyor...")

multi_hot_columns = [
    'predicted_tech_requirements',
    'predicted_soft_skills',
    'predicted_domain_knowledge',
    'predicted_project_experience',
    'predicted_certifications'
]

label_encoded_columns = [
    'predicted_experience_level',
    'predicted_education_requirement'
]

multi_hot_encoded_dfs = []
for col in multi_hot_columns:
    df[col] = df[col].fillna('').apply(
        lambda x: x if isinstance(x, list) else [item.strip() for item in x.split(',')] if x else []
    )
    mlb = MultiLabelBinarizer()
    encoded = pd.DataFrame(mlb.fit_transform(df[col]), columns=[f"{col}__{cls}" for cls in mlb.classes_])
    multi_hot_encoded_dfs.append(encoded)

label_encoded_dfs = []
for col in label_encoded_columns:
    df[col] = df[col].apply(lambda x: x[0] if isinstance(x, list) and len(x) > 0 else (x if isinstance(x, str) else 'Unknown'))
    le = LabelEncoder()
    df[col] = df[col].fillna('Unknown')
    encoded = pd.DataFrame(le.fit_transform(df[col]), columns=[col])
    label_encoded_dfs.append(encoded)

# TF-IDF uygulama
print("ðŸ“„ job_description metni TF-IDF ile vektÃ¶rleÅŸtiriliyor...")
df['job_description'] = df['job_description'].fillna('')
tfidf = TfidfVectorizer(max_features=300, stop_words='english')
tfidf_matrix = tfidf.fit_transform(df['job_description'])
tfidf_df = pd.DataFrame(tfidf_matrix.toarray(), columns=[f"tfidf_{word}" for word in tfidf.get_feature_names_out()])

# TÃ¼m Ã¶zellikleri birleÅŸtir
X = pd.concat(multi_hot_encoded_dfs + label_encoded_dfs + [tfidf_df.reset_index(drop=True)], axis=1)
y = df['grouped_category_id']

# -------------------------------
# 3. TRAIN-TEST AYIRIMI
# -------------------------------
print("ðŸ§ª EÄŸitim ve test seti hazÄ±rlanÄ±yor...")
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

# -------------------------------
# 4. LOGISTIC REGRESSION
# -------------------------------
print("ðŸ§® Logistic Regression eÄŸitiliyor...")
log_model = LogisticRegression(max_iter=1000, multi_class='multinomial', solver='lbfgs')
log_model.fit(X_train, y_train)
y_pred_log = log_model.predict(X_test)
log_accuracy = accuracy_score(y_test, y_pred_log)
log_report = classification_report(y_test, y_pred_log, zero_division=0)

# -------------------------------
# 5. RANDOM FOREST
# -------------------------------
print("ðŸŒ² Random Forest eÄŸitiliyor...")
rf_model = RandomForestClassifier(n_estimators=100, random_state=42)
rf_model.fit(X_train, y_train)
y_pred_rf = rf_model.predict(X_test)
rf_accuracy = accuracy_score(y_test, y_pred_rf)
rf_report = classification_report(y_test, y_pred_rf, zero_division=0)

# -------------------------------
# 6. SONUÃ‡LAR
# -------------------------------
print("\nðŸŽ¯ KARÅžILAÅžTIRMA SONUÃ‡LARI")
print(f"\nâœ… Logistic Regression Accuracy: {log_accuracy:.4f}")
print("ðŸ“‹ Logistic Regression Classification Report:")
print(log_report)

print(f"\nâœ… Random Forest Accuracy: {rf_accuracy:.4f}")
print("ðŸ“‹ Random Forest Classification Report:")
print(rf_report)

Ã¼Ã§Ã¼ncÃ¼_deneme = """
import pandas as pd
from sklearn.preprocessing import MultiLabelBinarizer, LabelEncoder
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report

print("ðŸ“¥ Veriler yÃ¼kleniyor...")
df = pd.read_csv("/Users/busesomunncu/Desktop/Linkedln Job Prediction Project/final_enriched_dataset.csv")

# -------------------------------
# 1. KATEGORÄ° GRUPLAMA
# -------------------------------
print("ðŸ”¢ Kategoriler gruplandÄ±rÄ±lÄ±yor...")

category_group_map = {
    1: 1, 2: 1, 4: 1,                     # Software & Web Dev
    3: 2, 17: 2,                          # Data & AI
    5: 3, 8: 3, 9: 3, 10: 3,              # IT & Support
    6: 4, 12: 4,                          # DevOps & Reliability
    7: 5,                                 # Cybersecurity
    11: 6, 13: 6, 14: 6, 15: 6, 16: 6,    # Embedded & Hardware
    18: 7, 21: 7,                         # Product & Project Mgmt
    19: 8, 20: 8, 22: 8, 23: 8,           # Business & Analysis
    24: 9, 25: 9, 26: 9, 29: 9,           # Sales & Operations
    27: 10, 28: 10, 30: 10                # Other
}
df['grouped_category_id'] = df['category_id'].map(category_group_map)

# -------------------------------
# 2. Ã–ZELLÄ°K MÃœHENDÄ°SLÄ°ÄžÄ°
# -------------------------------

print("ðŸ› ï¸ Ã–zellikler iÅŸleniyor...")

multi_hot_columns = [
    'predicted_tech_requirements',
    'predicted_soft_skills',
    'predicted_domain_knowledge',
    'predicted_project_experience',
    'predicted_certifications'
]

label_encoded_columns = [
    'predicted_experience_level',
    'predicted_education_requirement'
]

# Multi-hot encoding
multi_hot_encoded_dfs = []
for col in multi_hot_columns:
    df[col] = df[col].fillna('').apply(
        lambda x: x if isinstance(x, list) else [item.strip() for item in x.split(',')] if x else []
    )
    mlb = MultiLabelBinarizer()
    encoded = pd.DataFrame(mlb.fit_transform(df[col]), columns=[f"{col}__{cls}" for cls in mlb.classes_])
    multi_hot_encoded_dfs.append(encoded)

# Label encoding
label_encoded_dfs = []
for col in label_encoded_columns:
    df[col] = df[col].apply(lambda x: x[0] if isinstance(x, list) and len(x) > 0 else (x if isinstance(x, str) else 'Unknown'))
    le = LabelEncoder()
    df[col] = df[col].fillna('Unknown')
    encoded = pd.DataFrame(le.fit_transform(df[col]), columns=[col])
    label_encoded_dfs.append(encoded)

# TF-IDF (job_description)
print("ðŸ“„ job_description metni TF-IDF ile vektÃ¶rleÅŸtiriliyor...")
df['job_description'] = df['job_description'].fillna('')
tfidf = TfidfVectorizer(max_features=300, stop_words='english')
tfidf_matrix = tfidf.fit_transform(df['job_description'])
tfidf_df = pd.DataFrame(tfidf_matrix.toarray(), columns=[f"tfidf_{word}" for word in tfidf.get_feature_names_out()])

# TÃ¼m Ã¶zellikleri birleÅŸtir
X = pd.concat(multi_hot_encoded_dfs + label_encoded_dfs + [tfidf_df.reset_index(drop=True)], axis=1)
y_grouped = df['grouped_category_id']

# -------------------------------
# 3. MODEL EÄžÄ°TÄ°MÄ° (Random Forest)
# -------------------------------
print("ðŸŒ² Random Forest modeli eÄŸitiliyor...")
X_train, X_test, y_train, y_test = train_test_split(
    X, y_grouped, test_size=0.2, random_state=42, stratify=y_grouped
)

rf_model = RandomForestClassifier(n_estimators=100, random_state=42)
rf_model.fit(X_train, y_train)

# -------------------------------
# 4. TAHMÄ°N & METRÄ°KLER
# -------------------------------
print("ðŸ” Test verisi ile tahmin yapÄ±lÄ±yor...")
y_pred = rf_model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
report = classification_report(y_test, y_pred, zero_division=0)

print("\nâœ… MODEL SONUÃ‡LARI:")
print(f"ðŸŽ¯ Accuracy: {accuracy:.4f}")
print("ðŸ“‹ Classification Report:")
print(report)

"""
ikinci_deneme = """
import pandas as pd
from sklearn.preprocessing import MultiLabelBinarizer, LabelEncoder
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score, classification_report

# -------------------------------
# 1. VERÄ°YÄ° YÃœKLE
# -------------------------------

df = pd.read_csv("/Users/busesomunncu/Desktop/Linkedln Job Prediction Project/final_enriched_dataset.csv")

# -------------------------------
# 2. ENCODING KATEGORÄ°LERE GÃ–RE
# -------------------------------

multi_hot_columns = [
    'predicted_tech_requirements',
    'predicted_soft_skills',
    'predicted_domain_knowledge',
    'predicted_project_experience',
    'predicted_certifications'
]

label_encoded_columns = [
    'predicted_experience_level',
    'predicted_education_requirement'
]

# -------------------------------
# 3. MULTI-HOT ENCODING
# -------------------------------
multi_hot_encoded_dfs = []

for col in multi_hot_columns:
    df[col] = df[col].fillna('').apply(
        lambda x: x if isinstance(x, list) else [item.strip() for item in x.split(',')] if x else []
    )
    mlb = MultiLabelBinarizer()
    encoded = pd.DataFrame(mlb.fit_transform(df[col]), columns=[f"{col}__{cls}" for cls in mlb.classes_])
    multi_hot_encoded_dfs.append(encoded)

# -------------------------------
# 4. LABEL ENCODING
# -------------------------------
label_encoded_dfs = []

for col in label_encoded_columns:
    df[col] = df[col].apply(lambda x: x[0] if isinstance(x, list) and len(x) > 0 else (x if isinstance(x, str) else 'Unknown'))
    le = LabelEncoder()
    df[col] = df[col].fillna('Unknown')
    encoded = pd.DataFrame(le.fit_transform(df[col]), columns=[col])
    label_encoded_dfs.append(encoded)

# -------------------------------
# 5. TF-IDF: JOB DESCRIPTION
# -------------------------------
df['job_description'] = df['job_description'].fillna('')
tfidf = TfidfVectorizer(max_features=300, stop_words='english')
tfidf_matrix = tfidf.fit_transform(df['job_description'])
tfidf_df = pd.DataFrame(tfidf_matrix.toarray(), columns=[f"tfidf_{word}" for word in tfidf.get_feature_names_out()])

# -------------------------------
# 6. TÃœM Ã–ZELLÄ°KLERÄ° BÄ°RLEÅžTÄ°R
# -------------------------------
X = pd.concat(multi_hot_encoded_dfs + label_encoded_dfs + [tfidf_df.reset_index(drop=True)], axis=1)
y = df['category_id']

# -------------------------------
# 7. MODEL: LOGISTIC REGRESSION
# -------------------------------
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)

model = LogisticRegression(max_iter=1000, multi_class='multinomial', solver='lbfgs')
model.fit(X_train, y_train)

y_pred = model.predict(X_test)

# -------------------------------
# 8. PERFORMANS Ã–LÃ‡ÃœMÃœ
# -------------------------------
accuracy = accuracy_score(y_test, y_pred)
report = classification_report(y_test, y_pred, zero_division=0)

print(f"Accuracy: {accuracy:.4f}")
print(report)
"""
ilk_deneme = """
import pandas as pd
from sklearn.preprocessing import MultiLabelBinarizer, LabelEncoder
from sklearn.feature_extraction.text import TfidfVectorizer

# DosyayÄ± iÃ§e aktar
df = pd.read_csv("/Users/busesomunncu/Desktop/Linkedln Job Prediction Project/final_enriched_dataset.csv")
# -------------------------------
# 1. KATEGORÄ°LERE GÃ–RE AYRIMLAR
# -------------------------------

# Multi-hot encoding yapÄ±lacak sÃ¼tunlar
multi_hot_columns = [
    'predicted_tech_requirements',
    'predicted_soft_skills',
    'predicted_domain_knowledge',
    'predicted_project_experience',
    'predicted_certifications'
]

# Label encoding yapÄ±lacak sÃ¼tunlar
label_encoded_columns = [
    'predicted_experience_level',
    'predicted_education_requirement'
]

# ------------------------------------------
# 2. MULTI-HOT ENCODING Ä°ÅžLEMÄ°
# ------------------------------------------
multi_hot_encoded_dfs = []

for col in multi_hot_columns:
    # Liste deÄŸilse split ile listele
    df[col] = df[col].fillna('').apply(
        lambda x: x if isinstance(x, list) else [item.strip() for item in x.split(',')] if x else []
    )
    mlb = MultiLabelBinarizer()
    encoded = pd.DataFrame(mlb.fit_transform(df[col]), columns=[f"{col}__{cls}" for cls in mlb.classes_])
    multi_hot_encoded_dfs.append(encoded)

# ------------------------------------------
# 3. LABEL ENCODING Ä°ÅžLEMÄ°
# ------------------------------------------
label_encoded_dfs = []

for col in label_encoded_columns:
    # Listeyse ilk Ã¶ÄŸeyi al, boÅŸsa 'Unknown'
    df[col] = df[col].apply(lambda x: x[0] if isinstance(x, list) and len(x) > 0 else (x if isinstance(x, str) else 'Unknown'))
    le = LabelEncoder()
    df[col] = df[col].fillna('Unknown')
    encoded = pd.DataFrame(le.fit_transform(df[col]), columns=[col])
    label_encoded_dfs.append(encoded)

# ------------------------------------------
# 4. Ã–ZELLÄ°KLERÄ° (X) BÄ°RLEÅžTÄ°R
# ------------------------------------------
X_combined = pd.concat(multi_hot_encoded_dfs + label_encoded_dfs, axis=1)

# ------------------------------------------
# 5. HEDEF DEÄžÄ°ÅžKENÄ° (y) AYIR
# ------------------------------------------
print(X_combined)
y = df['category_id']
"""